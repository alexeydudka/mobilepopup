!function(a){var b={ajax:"",html:"",targetblock:"",content:{header:"",content:"",footer:""},type:"standart",confirmcontent:{header:"Confirm your action",content:"Are you sure you want to continue?",buttonoktext:"Yes",buttonnotext:"Cancel"},width:"",height:"",submitformbutton:".submit-mobilepopup-form",popupform:".mobilepopup-form",closeonoverflowclick:!0,shakeonoverflowclick:!0,fullscreeninmobile:!0,closehtml:'<a href="" class="button-close close"></a>',loadinghtml:'<div class="loader-wrap"><div class="loader"><span></span><span></span><span></span></div></div>',customclass:"",onloaded:function(a){return!0},onclosed:function(a){return!0},onconfirmed:function(a){return!0},onformsubmited:function(a,b){return!0}},c=b,d="mobilepopup",e="mobilepopup-overflow",f="mobilepopup-outer",g="mobilepopup-inner",h=".confirmok-mobilepopup-form",i=".confirmno-mobilepopup-form",j=a(window),k=0,l=popupoverflow=popupouter=popupinner="",m={init:function(d){var e={};c=a.extend(e,b,d),currenttopposition=a("body").scrollTop(),n(),p(),q(),l.addClass("open"),a("body").addClass("mobilepopup-opened"),o()},reload:function(b){c=a.extend(c,b),l.attr("class",d+" "+c.customclass+" open loading"),p(),q(),o()},resize:function(b){c=a.extend(c,b),p()},close:function(){l.removeClass("open"),a("body").removeClass("mobilepopup-opened"),popupinner.html(""),c.onclosed(l)}},n=function(){0==a("."+d).length&&(a("body").append("<div class='"+d+" "+c.customclass+" loading'><div class='"+e+"'></div><div class='"+f+"'><div class='"+g+"'></div>"+c.closehtml+c.loadinghtml+"</div></div>"),l=a("."+d),popupoverflow=a("."+e),popupinner=a("."+g),popupouter=a("."+f),s())},o=function(){c.fullscreeninmobile?popupouter.removeClass("disable-mobile-fullscreen"):popupouter.addClass("disable-mobile-fullscreen")},p=function(){var b="";""!=a.trim(c.width)&&(b+="width:"+c.width+";"),""!=a.trim(c.height)&&(b+="height:"+c.height+";"),popupouter.attr("style",b),r()},q=function(){switch(c.type){case"standart":""!=a.trim(c.ajax)?a.post(c.ajax,function(a){popupinner.html(a),l.removeClass("loading"),c.onloaded(l)}):""!=a.trim(c.html)||""!=a.trim(c.targetblock)?(popupinner.html(""!=a.trim(c.html)?c.html:a(c.targetblock).find(">*").clone()),l.removeClass("loading"),c.onloaded(l)):""==a.trim(c.content.content)&&""==a.trim(c.content.header)&&""==a.trim(c.content.footer)||(popupinner.html("<div class='header'>"+c.content.header+"</div><div class='content'>"+c.content.content+"</div><div class='footer'>"+c.content.footer+"</div>"),l.removeClass("loading"),c.onloaded(l));break;case"confirm":popupinner.html("<div class='header'>"+c.confirmcontent.header+"</div><div class='content'>"+c.confirmcontent.content+"</div><div class='footer'><a href='' class='button confirmok-mobilepopup-form'>"+c.confirmcontent.buttonoktext+"</a><a href='' class='button button-gray confirmno-mobilepopup-form'>"+c.confirmcontent.buttonnotext+"</a></div>"),l.removeClass("loading"),c.onloaded(l)}},r=function(){popupouter.css({"max-width":j.innerWidth()-20+"px","max-height":j.innerHeight()-20+"px"})},s=function(){popupoverflow.on("click",function(){return c.closeonoverflowclick?m.close():c.shakeonoverflowclick&&!popupouter.hasClass("shake-popup")&&(popupouter.addClass("shake-popup"),clearTimeout(k),k=setTimeout(function(){popupouter.removeClass("shake-popup")},500)),!1}),l.on("click",".close,"+i,function(){return m.close(),!1}),l.on("click",h,function(){return c.onconfirmed(l),m.close(),!1}),l.on("click",c.submitformbutton,function(){var b=l.find(c.popupform);return b.length>0&&(l.addClass("loading"),a.post(b.attr("action")+"?"+b.serialize(),function(a){c.onformsubmited(a,l),l.removeClass("loading")})),!1}),j.on("orientationchange resize",function(){r()})};a.mobilepopup=function(b,c){return m[b]?m[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" not found for mobilepopup"):m.init.apply(this,arguments)}}(jQuery);